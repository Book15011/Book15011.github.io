<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Projects - Thanisorn J.</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            perspective: 1200px;
            scroll-behavior: smooth;
        }
        
        /* Consistent Header Styles */
        header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 25; /* High z-index to be above everything */
            background: rgba(10, 10, 20, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logo {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: 3px;
            text-decoration: none;
            color: white;
            position: relative;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
            transition: all 0.3s ease;
        }
        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 1px;
            background: #00eeff;
            transition: width 0.4s ease;
        }
        .logo:hover::after {
            width: 100%;
        }
        nav {
            display: flex;
            gap: 12px;
        }
        nav a {
            margin-left: 40px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
            font-size: 1.1rem;
            letter-spacing: 1.5px;
            position: relative;
            padding-bottom: 5px;
            transition: color 0.3s ease;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: #00eeff;
            transition: width 0.4s ease;
        }
        nav a:hover, nav a:focus {
            color: white;
        }
        nav a:hover::after, nav a:focus::after {
            width: 100%;
        }
        nav a.active {
            color: white;
            font-weight: 500;
        }
        nav a.active::after {
            width: 100%;
        }

        .container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 150px 20px 60px; /* Adjusted top padding */
            overflow: hidden;
        }
        
        .page-heading {
            text-align: center;
            margin-bottom: 50px;
            z-index: 10;
            animation: fadeInDown 1s ease-out;
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem; /* This h1 is now the page title, not the header */
            letter-spacing: 3px;
            margin-bottom: 15px;
            background: linear-gradient(to right, #ff9a9e, #fad0c4, #fad0c4, #a18cd1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 6px;
            text-transform: uppercase;
            opacity: 0.8;
        }
        
        .shelf-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            perspective: 2000px;
            margin-top: 30px;
            transform: translateX(-10%);
        }

        .layers-stack {
            position: relative;
            width: 85%;
            height: 100%;
            transform-style: preserve-3d;
            transform: rotateY(-25deg) scale(0.9);
        }

        .layer {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60%;
            height: 280px;
            border-radius: 15px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            text-align: left;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            transform-style: preserve-3d;
            backface-visibility: hidden;
            cursor: pointer;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform-origin: center center;
            z-index: 1;
        }

        .layer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent, rgba(0,0,0,0.5));
            z-index: -1;
            opacity: 0.8;
        }

        .layer-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            letter-spacing: 1px;
            transition: all 0.5s ease;
            word-break: break-word; /* Prevents long titles from overflowing */
        }

        .divider {
            width: 180px;
            height: 3px;
            background: linear-gradient(to right, #e94560, transparent);
            margin: 20px 0;
            border: none;
            transition: all 0.5s ease;
        }

        .content {
            font-size: 1.1rem;
            line-height: 1.7;
            max-width: 550px;
            margin-top: 10px;
            font-weight: 300;
            opacity: 0.9;
            transition: all 0.5s ease;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        .project-link {
            color: #0f0c29;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            padding: 10px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            transition: all 0.3s ease;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .project-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);
        }

        .stats {
            display: flex;
            justify-content: flex-start;
            gap: 30px;
            margin-top: 25px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(to right, #ff9a9e, #fad0c4);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 8px rgba(0,0,0,0.6);
        }

        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 5px;
            opacity: 0.8;
        }

        .instructions {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            z-index: 10;
            animation: pulse 2s infinite;
        }

        .depth-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 20;
            background: rgba(0,0,0,0.4);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .depth-bar {
            width: 180px;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .depth-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 60%;
            background: linear-gradient(to right, #ff9a9e, #a18cd1);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 40px;
            z-index: 10;
            justify-content: center;
            width: 100%;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        .btn:active {
            transform: translateY(1px);
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 12, 41, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        body.modal-active .modal-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw; /* Better for mobile */
            max-width: 700px; /* More balanced on desktop */
            height: auto;
            max-height: 80vh;
            border-radius: 15px;
            padding: 30px;
            background: inherit;
            z-index: 1001;
            cursor: default;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            transition: background 0.4s ease;
        }
        
        .modal-content.active {
            display: block;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            border-radius: 15px;
            z-index: -1;
        }
        
        .modal-layer-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            letter-spacing: 1px;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        .modal-close-btn:hover {
            opacity: 1;
            transform: rotate(90deg);
        }

        /* Depth effect styling */
        .depth-cursor {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,154,158,0.2) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .depth-shadow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,0,0,0.4) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            filter: blur(30px);
            pointer-events: none;
            z-index: 4;
            opacity: 0;
        }
        
        .layer-hover-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }
        
        .hover-indicator {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .hover-indicator::before {
            content: "→";
            color: white;
            font-size: 1.5rem;
        }
        
        .layer:hover .hover-indicator {
            opacity: 1;
            transform: translateY(-50%) translateX(10px);
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @media (max-width: 1024px) {
            .layer {
                width: 80%;
                height: 300px;
                padding: 25px;
            }
            
            .layer-title {
                font-size: 2.5rem;
            }
            
            h1 {
                font-size: 3rem;
            }

            .shelf-container {
                transform: translateX(-5%);
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 15px 5%;
                flex-direction: column;
                gap: 12px;
            }
            .logo {
                margin-bottom: 5px;
            }
            nav {
                justify-content: center;
                flex-wrap: wrap;
            }

            h1 {
                font-size: 2.5rem;
            }
            .shelf-container {
                height: 450px;
                transform: translateX(0);
            }
            
            .layer {
                width: 90%;
                height: 280px;
                padding: 20px;
            }
            
            .layer-title {
                font-size: 2rem;
            }
            
            .stats {
                gap: 15px;
            }
            
            .stat-value {
                font-size: 2.2rem;
            }
            
            .hover-indicator {
                right: -30px;
                width: 25px;
                height: 25px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
                letter-spacing: 4px;
            }
            
            .layer {
                height: 260px;
                padding: 15px;
            }
            
            .layer-title {
                font-size: 1.8rem;
            }
            
            .divider {
                margin: 15px 0;
                width: 150px;
            }
            
            .content {
                font-size: 0.95rem;
            }
            
            .stats {
                gap: 10px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .instructions {
                font-size: 0.9rem;
                padding: 0 10px;
            }
            
            .depth-indicator {
                top: 10px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .depth-bar {
                width: 130px;
            }
            
            .layers-stack {
                width: 100%;
            }
            
            .hover-indicator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo">THANISORN J.</a>
        <nav>
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="about.html"><i class="fas fa-user"></i> About</a>
            <a href="projects.html" class="active"><i class="fas fa-code"></i> Projects</a>
            <a href="contact.html"><i class="fas fa-envelope"></i> Contact</a>
        </nav>
    </header>
    <div class="container">
        <div class="page-heading">
            <h1>My Projects</h1>
            <div class="subtitle">A SELECTION OF MY WORK</div>
        </div>
        
        <div class="depth-indicator">
            <span>Project: <span id="depthValue">3/6</span></span>
            <div class="depth-bar">
                <div class="depth-progress" id="depthProgress"></div>
            </div>
        </div>
        
        <div class="shelf-container">
            <div class="layers-stack" id="layersStack">
                <!-- Project Layers -->
                <div class="layer" style="background: linear-gradient(135deg, #6d327c, #482255);">
                    <div class="layer-title">3D Robot Portfolio</div>
                    <div class="divider"></div>
                    <div class="content">
                        The very website you are on! A portfolio with a 3D robot that tracks cursor movements, built with Three.js and GSAP.
                        <a href="index.html" target="_blank" class="project-link">View Live</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>

                <div class="layer" style="background: linear-gradient(135deg, #327c7c, #225555);">
                    <div class="layer-title">HearthVoice</div>
                    <div class="divider"></div>
                    <div class="content">
                        A compassionate AI companion for the elderly, using voice cloning and animated avatars to combat isolation. 
                        <a href="https://github.com/Book15011/HearthVoice" target="_blank" class="project-link">View on GitHub</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>

                <div class="layer" style="background: linear-gradient(135deg, #7c6d32, #554822);">
                    <div class="layer-title">GVHMR2PBHC</div>
                    <div class="divider"></div>
                    <div class="content">
                        A motion processing pipeline converting GVHMR outputs to PBHC format, with advanced motion stabilization for robotics.
                        <a href="https://github.com/Book15011/GVHMR2PBHC" target="_blank" class="project-link">View on GitHub</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>

                <div class="layer" style="background: linear-gradient(135deg, #327c6d, #225548);">
                    <div class="layer-title">Minigame_ML</div>
                    <div class="divider"></div>
                    <div class="content">
                        An AI bot trained with reinforcement learning for a simplified Chinese Checkers game, mastering moves with Q-learning. 
                        <a href="https://github.com/Book15011/Minigame_ML" target="_blank" class="project-link">View on GitHub</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>
                
                <div class="layer" style="background: linear-gradient(135deg, #48327c, #2d2255);">
                    <div class="layer-title">HandTremors Project</div>
                    <div class="divider"></div>
                    <div class="content">
                        A robotic arm with an active ball joint to assist patients with hand tremors by filtering out unwanted movements. 
                        <a href="https://github.com/Book15011/HandTremors_Project" target="_blank" class="project-link">View on GitHub</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>

                <div class="layer" style="background: linear-gradient(135deg, #7c3232, #552222);">
                    <div class="layer-title">VERITAS</div>
                    <div class="divider"></div>
                    <div class="content">
                        An inclusive education app supporting SDG #4, offering Braille learning, multilingual tools, and more for marginalized learners.
                        <a href="https://github.com/Book15011/VERITAS" target="_blank" class="project-link">View on GitHub</a>
                    </div>
                    <div class="hover-indicator"></div>
                </div>
            </div>
            <div class="depth-cursor" id="depthCursor"></div>
            <div class="depth-shadow" id="depthShadow"></div>
        </div>
        
        <div class="controls">
            <button class="btn" id="prevBtn">Previous Layer</button>
            <button class="btn" id="nextBtn">Next Layer</button>
            <button class="btn" id="resetBtn">Reset View</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal-content" id="modalContent">
        <!-- Modal content will be injected here -->
    </div>
    <div class="instructions">← Scroll or use buttons to explore projects | Hover for details | Click to expand</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const layers = document.querySelectorAll('.layer');
            const layersStack = document.getElementById('layersStack');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const resetBtn = document.getElementById('resetBtn');
            const depthValue = document.getElementById('depthValue');
            const depthProgress = document.getElementById('depthProgress');
            const modalOverlay = document.getElementById('modalOverlay');
            const modalContent = document.getElementById('modalContent');
            const depthCursor = document.getElementById('depthCursor');
            const depthShadow = document.getElementById('depthShadow');
            
            let hoveredLayer = null;
            let currentDepth = Math.floor(layers.length / 2); // Start at the middle layer
            const maxDepth = layers.length - 1;
            const zStep = 200; // Depth step between layers
            const scaleStep = 0.1; // Scale reduction per layer
            
            // Initial positioning of layers
            positionLayers();
            
            // Update layers based on current depth
            function positionLayers() {
                layers.forEach((layer, index) => {
                    // If a modal is active, don't alter its styles from here.
                    if (layer.classList.contains('is-modal')) return;

                    // Calculate depth difference from current layer
                    const depthDiff = index - currentDepth;
                    
                    // Calculate position and scale for depth effect
                    const translateZ = depthDiff * -zStep;
                    const scale = 1 - Math.abs(depthDiff) * scaleStep;
                    const translateX = depthDiff * 50; // Slight horizontal offset
                    const translateY = -Math.abs(depthDiff) * 20; // Vertical offset for depth effect
                    
                    // Apply transform with depth effect
                    layer.style.transform = `
                        translate(-50%, -50%)
                        translateX(${translateX}px)
                        translateY(${translateY}px)
                        translateZ(${translateZ}px)
                        scale(${scale})
                    `;
                    
                    // Set z-index for proper stacking
                    layer.style.zIndex = layers.length - Math.abs(depthDiff);
                    
                    // Store depth difference for hover effect
                    layer.dataset.depthDiff = depthDiff;
                });
                
                // Update depth indicator
                depthValue.textContent = `${currentDepth + 1}/${layers.length}`;
                depthProgress.style.width = `${(currentDepth / maxDepth) * 100}%`;
                
                // Rotate entire stack for perspective
                layersStack.style.transform = `rotateY(-27deg) rotateX(-15deg) rotateZ(10deg) scale(0.8)`;
            }
            
            // Enhanced hover effect with depth
            layers.forEach(layer => {
                layer.addEventListener('mouseenter', function() {
                    if (document.body.classList.contains('modal-active')) return;
                    hoveredLayer = this;
                    
                    // Calculate hover effect - bring forward, scale up, and peek to the right
                    const hoverTranslateZ = 80; // Bring all cards to a consistent Z depth on hover
                    const hoverScale = 1.2; // Scale up consistently
                    const peekTranslateX = 400; // Move it significantly to the right
                    const peekRotateY = 2; // Rotate it slightly to face the user
                    
                    
                    this.style.transform = `
                        translate(-50%, -50%)
                        translateX(${peekTranslateX}px)
                        translateY(0px)
                        translateZ(${hoverTranslateZ}px)
                        scale(${hoverScale})
                        rotateY(${peekRotateY}deg)
                    `;
                    this.style.zIndex = layers.length + 10;
                    
                    // Show depth cursor effect
                    depthCursor.style.opacity = 1;
                    depthShadow.style.opacity = 0.8;
                });

                layer.addEventListener('mouseleave', function() {
                    if (document.body.classList.contains('modal-active')) return;
                    hoveredLayer = null;
                    
                    const depthDiff = parseInt(this.dataset.depthDiff);
                    const absDepth = Math.abs(depthDiff);
                    
                    // Return to original position
                    const translateZ = depthDiff * -zStep;
                    const scale = 1 - absDepth * scaleStep;
                    const translateX = depthDiff * 40;
                    const translateY = -absDepth * 20;
                    
                    this.style.transform = `
                        translate(-50%, -50%)
                        translateX(${translateX}px)
                        translateY(${translateY}px)
                        translateZ(${translateZ}px)
                        scale(${scale})
                    `;
                    this.style.zIndex = layers.length - absDepth;
                    
                    // Hide depth cursor effect
                    depthCursor.style.opacity = 0;
                    depthShadow.style.opacity = 0;
                });
            });
            
            // Move to next layer
            nextBtn.addEventListener('click', () => {
                currentDepth = (currentDepth + 1) % layers.length;
                positionLayers();
            });
            
            // Move to previous layer
            prevBtn.addEventListener('click', () => {
                currentDepth = (currentDepth - 1 + layers.length) % layers.length;
                positionLayers();
            });
            
            // Reset to center
            resetBtn.addEventListener('click', () => {
                currentDepth = Math.floor(layers.length / 2);
                positionLayers();
            });
            
            // Mouse wheel scrolling
            window.addEventListener('wheel', function(e) {
                // Throttle the scroll events
                if (this.throttleScroll) return;
                this.throttleScroll = true;
                
                setTimeout(() => {
                    this.throttleScroll = false;
                }, 900); // Increased timeout to make scrolling less sensitive.
                         // This prevents a single scroll action from triggering
                         // multiple project changes in quick succession.
                
                const changeAndPositionLayers = () => {
                    if (e.deltaY > 0) {
                        // Scroll down - move to next layer
                        currentDepth = (currentDepth + 1) % layers.length;
                    } else {
                        // Scroll up - move to previous layer
                        currentDepth = (currentDepth - 1 + layers.length) % layers.length;
                    }
                    positionLayers();
                };

                if (hoveredLayer) {
                    // If a layer is peeking, trigger its mouseleave to close it first
                    hoveredLayer.dispatchEvent(new Event('mouseleave'));
                    // Wait for the close animation to start before changing depth
                    setTimeout(changeAndPositionLayers, 150);
                } else {
                    // If no layer is peeking, change depth immediately
                    changeAndPositionLayers();
                }
            });
            
            // NEW MODAL LOGIC
            function openModal(layer) {
                // Set the modal's background to match the clicked layer
                modalContent.style.background = layer.style.background;

                // Populate the modal with the layer's inner content
                modalContent.innerHTML = layer.innerHTML;

                // Re-query for elements inside the new modal content to adjust them
                const title = modalContent.querySelector('.layer-title');
                if (title) title.className = 'modal-layer-title';

                const hoverIndicator = modalContent.querySelector('.hover-indicator');
                if (hoverIndicator) hoverIndicator.remove();
                
                // Add a close button to the modal
                const closeBtn = document.createElement('button');
                closeBtn.className = 'modal-close-btn';
                closeBtn.innerHTML = '&times;';
                closeBtn.addEventListener('click', closeModal);
                modalContent.appendChild(closeBtn);
                
                // Activate the modal view
                document.body.classList.add('modal-active');
                modalContent.classList.add('active');
            }

            function closeModal() {
                document.body.classList.remove('modal-active');
                modalContent.classList.remove('active');
                // Reset background for the next modal
                modalContent.style.background = '';
            }

            layers.forEach(layer => {
                layer.addEventListener('click', function(event) {
                    // Don't open modal if a link was clicked or if a modal is already active
                    if (event.target.closest('a') || document.body.classList.contains('modal-active')) {
                        return;
                    }
                    openModal(this);
                });
            });
            
            modalOverlay.addEventListener('click', closeModal);

            // Auto-explore for demonstration
            let autoExplore = true;
            setInterval(() => {
                if (autoExplore) {
                    currentDepth = (currentDepth + 1) % layers.length;
                    positionLayers();
                }
            }, 5000);
            
            // Stop auto-explore on interaction
            layersStack.addEventListener('mouseenter', () => {
                autoExplore = false;
            });
            
            layersStack.addEventListener('mouseleave', () => {
                autoExplore = true;
            });
            
            // Depth cursor effect on mouse move
            document.addEventListener('mousemove', (e) => {
                const x = e.clientX;
                const y = e.clientY;
                depthCursor.style.left = `${x}px`;
                depthCursor.style.top = `${y}px`;
                depthShadow.style.left = `${x}px`;
                depthShadow.style.top = `${y}px`;
            });
        });
    </script>
</body>
</html>
